import RPi.GPIO as GPIO
import time

GPIO.setmode(GPIO.BOARD)

# Define the GPIO pins for the L298N motor driver
OUT1 = 12
OUT2 = 11
OUT3 = 13
OUT4 = 15

# Set the GPIO pins as output
GPIO.setup(OUT1, GPIO.OUT)
GPIO.setup(OUT2, GPIO.OUT)
GPIO.setup(OUT3, GPIO.OUT)
GPIO.setup(OUT4, GPIO.OUT)

# Set initial state of pins to low
GPIO.output(OUT1,GPIO.LOW)
GPIO.output(OUT2,GPIO.LOW)
GPIO.output(OUT3,GPIO.LOW)
GPIO.output(OUT4,GPIO.LOW)

# Sets number of steps to move
num_steps = 1000

# Sets delay between steps
step_delay = 0.01

try:
    while True:
        current_step = 0

        for x in range(num_steps):
            # ----------- REVERSED SEQUENCE ---------
            if current_step == 0:
                GPIO.output(OUT1, GPIO.HIGH)
                GPIO.output(OUT2, GPIO.LOW)
                GPIO.output(OUT3, GPIO.LOW)
                GPIO.output(OUT4, GPIO.HIGH)
            elif current_step == 1:
                GPIO.output(OUT1, GPIO.LOW)
                GPIO.output(OUT2, GPIO.HIGH)
                GPIO.output(OUT3, GPIO.LOW)
                GPIO.output(OUT4, GPIO.HIGH)
            elif current_step == 2:
                GPIO.output(OUT1, GPIO.LOW)
                GPIO.output(OUT2, GPIO.HIGH)
                GPIO.output(OUT3, GPIO.HIGH)
                GPIO.output(OUT4, GPIO.LOW)
            elif current_step == 3:
                GPIO.output(OUT1, GPIO.HIGH)
                GPIO.output(OUT2, GPIO.LOW)
                GPIO.output(OUT3, GPIO.HIGH)
                GPIO.output(OUT4, GPIO.LOW)
            # ---------------------------------------

            time.sleep(step_delay)
            print(f"step {current_step}")

            # Move to next step (reversed)
            current_step = (current_step + 1) % 4

        GPIO.cleanup()
        break

except KeyboardInterrupt:
    GPIO.cleanup()
